  - sensor:
      - name: "House Status"
        state: >
          {% set zone_occupied = states('zone.home') | default(0) | int > 0 %}
          {% set guests = is_state('input_boolean.guest_mode', 'on') %}
          {% set presence = is_state('binary_sensor.occupancy_livingroom', 'on') or is_state('binary_sensor.occupancy_frontroom', 'on') or is_state('binary_sensor.occupancy_study', 'on') or is_state('binary_sensor.occupancy_master', 'on') or is_state('binary_sensor.occupancy_sofia', 'on') or is_state('binary_sensor.occupancy_joseph', 'on') or is_state('binary_sensor.occupancy_theo', 'on') %}
          {% if zone_occupied or guests or presence %}
            Occupied
          {% else %}
            Vacant
          {% endif %}
        icon: >
          {% if is_state('sensor.house_status', 'Occupied') %}
            mdi:home-import-outline
          {% else %}
            mdi:home-export-outline
          {% endif %}

      - name: "Garage No Motion"
        state: '{{ ((as_timestamp(now()) - as_timestamp(states.binary_sensor.motion_garage.last_updated)) / 60) | int}}'
      - name: 'Calendar Location'
        state: >
          {% if states.calendar.family_family.attributes.location is defined %}
            {{ state.calendar.family_family.attributes.location }}
          {% else %}
            zone.sew
          {% endif %}
      - name: 'Power Heater Joseph'
        state: >
          {% if states.switch.heater_joseph.state == 'on' %}
            1200
          {% else %}
            0
          {% endif %}
      - name: Energy Cost Savings
        state: >
          {{ "$%.2f" | format((float(states("sensor.timeoff_livingroom") | default(0)) * 8.7 / 1000 * 0.28 + float(states("sensor.timeoff_frontroom") | default(0)) * 4.1 / 1000 * 0.28 + float(states("sensor.timeoff_zoeydesk" | default(0))) * 7.0 / 1000 * 0.28))}}

  - trigger:
      - platform: state
        entity_id:
          - binary_sensor.motion_master
          - binary_sensor.motion_master_dsc
          - binary_sensor.motion_sofia
          - binary_sensor.motion_joseph
          - binary_sensor.motion_theo
          - binary_sensor.motion_theo_dsc
        from: "off"
        to: "on"
        id: bedroom
      - platform: state
        entity_id:
          - binary_sensor.motion_livingroom
          - binary_sensor.motion_frontroom
          - binary_sensor.motion_laundry
          - binary_sensor.motion_garage
          - binary_sensor.motion_garage_dsc
        from: "off"
        to: "on"
        id: common
    sensor:
      - unique_id: last_motion
        name: Last Motion
        icon: mdi:run-fast
        state: "{{ area_name(trigger.entity_id) }}"
        attributes:
          room_type: "{{ trigger.id | capitalize }}"
          entity_id: "{{ trigger.entity_id }}"

  - trigger:
      - platform: numeric_state
        entity_id: sensor.power_dishwasher
        below: 20
        for: "00:03:00"
        id: low_power
      - platform: numeric_state
        entity_id: sensor.power_dishwasher
        above: 20
        id: high_power
      - platform: homeassistant
        event: start
        id: reboot
      - platform: state
        entity_id: binary_sensor.door_dishwasher
        to: "on"
        id: door_opened
    sensor:
      - unique_id: dishwasher_state
        name: Dishwasher
        icon: mdi:dishwasher
        state: |
          {% if trigger.id == "door_opened" and is_state("sensor.dishwasher", "Finished") %}
            Idle
          {% elif trigger.id == "high_power" %}
            Running
          {% elif trigger.id == "low_power" and is_state("sensor.dishwasher", "Running") %}
            Finished
          {% elif trigger.id == "reboot" and float(states("sensor.power_dishwasher")) > 20 %}
            Running
          {% elif trigger.id == "reboot" and float(states("sensor.power_dishwasher")) < 20 %}
            Idle
          {% else %}
            Unknown
          {% endif %}
          
  - trigger:
      - platform: numeric_state
        entity_id: sensor.power_washingmachine
        below: 20
        for: "00:03:00"
        id: low_power
      - platform: numeric_state
        entity_id: sensor.power_washingmachine
        above: 20
        id: high_power
      - platform: homeassistant
        event: start
        id: reboot
      - platform: state
        entity_id: binary_sensor.door_washingmachine
        to: "on"
        id: door_opened
    sensor:
      - unique_id: washing_machine_state
        name: Washing Machine
        icon: mdi:washing-machine
        state: |
          {% if trigger.id == "door_opened" and is_state("sensor.washing_machine", "Finished") %}
            Idle
          {% elif trigger.id == "high_power" %}
            Running
          {% elif trigger.id == "low_power" and is_state("sensor.washing_machine", "Running") %}
            Finished
          {% elif trigger.id == "reboot" and float(states("sensor.power_washingmachine")) > 20 %}
            Running
          {% elif trigger.id == "reboot" and float(states("sensor.power_washingmachine")) < 20 %}
            Idle
          {% else %}
            Unknown
          {% endif %}
